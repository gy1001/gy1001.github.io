## 我与 Electron 和 Rubick 的故事

### 1. 结识 Electron

我起初没有使用过 `Electron`，最开始接触它是因为看到了一个基于 Electron 开发的图床工具 [PicGo](https://picgo.github.io/PicGo-Doc/en/guide/)。 它有一个核心功能非常吸引我，就是 macOS 下可以直接拖拽图片进入任务托盘上传图片：

<p align=center><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/08ce2dacc03d459580652f9a2b23a8e2~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=419\&h=169\&s=2189193\&e=gif\&f=27\&b=c7beb0" alt="image.png"  /></p>

当时正好我们团队也需要搞一个内部的 CDN 图片资源管理图床，用于项目图片资源压缩并直接上传到 CDN 上，之前我们做了个网页版。而这里我深刻地感受到了 Electron 的强大，可以极大地提高工作效率，参考 PicGo 我尝试做了第一个 Electron 项目，完成了图片压缩上传到内部 CDN 的桌面端应用。


### 2. 一些痛点开始出现

之后公司内部因为开发和后端进行接口联调测试环境时，经常会涉及到一些状态改变要看交互样式的问题。比如，测试需要测商品的待支付、支付中、支付完成等各种节点的交互样式是否符合预期，这种情况测试一般会去造数据或者让后端改数据库接口。有的小伙伴可能会用 `Charles` 修改返回数据进行测试，但 `Charles` 的抓包体验和配置体验感觉有点麻烦，对新人不是很友好。

所以，我们基于 Electron 做了个非常易用的**抓包& mock 工具**：

<p align=center><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/21921a624b534c86a7ca4a514eee957a~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1440&h=896&s=250725&e=png&b=eff3f4" alt="image.png"  /></p>

**这也是 Rubick 最早的雏形**。随后，我们发现当页面发布线上的时候，没有办法在微信环境内对线上页面进行调试，所以开发了一个基于 `winner` 的远程调试功能。

但随着该 Rubick 在内部不断推广和使用，所需功能也越来越多。我们需要需求管理、性能评估、埋点检测等工具。这些工具的增加一方面导致 Rubick 体积暴增，一方面又导致了用户需要不断更新软件，导致用户体验非常差。

其次，我们在推广给测试、UI 同学使用的时候，发现他们其实并不关注前面的页面调试、性能测评等功能，可能只是用到其中某一项，所以整个项目对他们来说就显得很臃肿。



### 3. 看到了 uTools

突然有一天从朋友口中得知有一个插件化的工具箱 [uTools](https://u.tools/) 可以解决我的痛点。

所以就想把上面提到的那些工具按照 `uTools` 的规范进行插件化，发布到 uTools 市场，在 uTools 里通过插件的方式使用它们。但我发现发布插件只能发布到 `uTools` 的公网服务器，而且在使用插件的时候可能会产生一些机密数据（比如秘钥、密码、服务器数据……），所以这又涉及到数据安全的问题。

无奈，难道真的要自己做一个这样的工具吗？真的是有点头大。不过想想也挺有意思的。**至此，我萌生了要开发一个媲美 uTools 的开源工具箱的念头，这也就有了后来的 Rubick。**




### 4. 和商业软件 uTools 的一些区别

#### （1）技术实现和功能上的区别

如果你听说过 [uTools](https://u.tools/) ，那你可能会问：这和 `uTools` 有啥区别呢？看着很像啊！ 

的确，`rubick` 的开发初衷就是参考 `uTools` 做的。不过，经过我们不懈地努力和迭代，我们已经和 `uTools` 有了大量的差异化。

1.  rubick 所有的插件是基于 `npm` 的管理方式，插件发布、安装更加简单、安全。`uTools` 则是需要走他们自己的发布审批流，需要收到打 `upx` 包。
2.  rubick 支持 0 成本一键内网部署，而 `uTools` 私有化部署则需要付费。
3.  rubick 数据多端同步是基于 `webdav` 做的，所有数据都存储到用户自己的网盘中，没有中间人！！更加安全！而 `uTools` 是他们自己的服务器。
4.  rubick 支持系统插件，这对于`todoList`、`超级面板`、`超级剪贴板`、`取色器` 等插件来说体验是最好的。`uTools` 不支持。
5.  rubick 支持自定义主题、欢迎语、头像…… `uTools` 需付费会员。
6.  rubick 所有插件都是开源免费，`uTools` 部分热门插件需要二次收费。
7.  rubick 所有代码全部开源，可以轻松二开！


#### （2）交互设计上的重构

事情的起因是这样的，刚开始开源的时候，整体的交互和设计大量参考了 `uTools` 主要原因是我是一个独立开发者，没有专门搞过 `UI` 交互设计这块，但当我发布 `rubick 1.0` 版本到社区时，收到了大量的质疑，说我是抄袭 `uTools` 的，当时真的是一把辛酸泪。虽说 `UI` 布局上是参考了 `uTools`
，可代码确实是我一行一行码出来的 😭。我只是想为大家提供一种社区解决方案而已\~

**无奈，我下定决心，有朝一日一定要和 `uTools` 在 `UI` 上做差异化！**

为了这个心结，前不久，我外包了一个设计师，需要 `￥4000` 块钱来设计改版 `rubick`。
可是作为开源项目，实在是囊中羞涩\~，于是我在 `rubick` 交流群里面发起了一个众筹项目：

<p align=center><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d797a234d26b4122bd2398568a8035cd~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=720&#x26;h=680&#x26;s=296227&#x26;e=png&#x26;b=f2f2f2" alt="" width="70%" /></p>

本以为会石沉大海，但令我感到意外的是不到 1h 就筹够了 2000+ 的金额。 **这里再次致谢所有参与众筹的小伙伴们！**

> 为了感谢之前参与众筹的小伙伴，本小册也为那些参与过众筹的小伙伴提供了 1 折超低优惠码。

为了不辜负小伙伴们的期待，在国庆节前，设计师终于给到我新版的交互设计稿。
`2023 年 10 月` 那个国庆节我自己在家加班加点，终于赶在节后，我们发布了 `rubick v4` 版本，对整体的交互和设计做了大量改动。🎉 🎉





## 关于开源这件事儿

### 1. 曲折的开源路

刚开始把 `Rubick` 开源的时候，我自己买了服务器和 oss 服务器来做 rubick 的数据管理和插件存储。

但是服务器这个东西还是太费钱，所以在 `Rubick 2.0` 的阶段，重新设计了一套基于 npm 的插件管理体系，把所有插件托管到 npm 上，这样就不需要 oss 服务器了。另外，rubick 所需要的插件列表数据等都托管在 gitcode 上做 raw 方式请求（这些都是为了白嫖数据存储的成本）。

其实做开源这件事完全是靠自己的兴趣和爱好，从 `21 年 5 月` 开始开源到现在，中间我放弃了快 1 年没有更新 rubick 了。主要是投入开源比较费时间，每天打开 issue 都会看到一堆需要解决的问题，想想就头大。期间我招募了一些社区开源爱好者一起来维护 rubick，这样在我 “大姨夫” 期间可以让 rubick 持续迭代，但还是比较难的。

记得有一次我发了条朋友圈：

<p align=center><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e00359f596964f2b8cac29af06feff0a~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1084&h=1044&s=191287&e=png&b=fefefe" alt="image.png"  /></p>


有意愿的也就 3-4 个，但正真贡献代码的是 0 个，还是没有成功……


### 2. 关于开源的收入？

开源，意味着就是靠爱发电，几乎是没有任何收入的，为什么说是几乎呢？因为偶尔有一些小伙伴觉得你的项目不错，还会给你一点打赏。但是这些钱可以忽略不计了~

### 3. 靠爱发电的动力？
开源这个事情，本身就不是以盈利为目的的，开源给我带来了很多东西，认识了很多志同道合的小伙伴，也服务了很多开发者。金钱之外，带来最多的就是作为程序员的成就感了，因为我也可以说我是一个拥有 `7K+ star` 项目的作者，这是一份无法用钱衡量的成就感。

如果你也对 rubick 感兴趣，真心希望可以加入我们一起为开源做贡献（继续画饼）~


## 谈谈学习 Electron 这件事儿

`Electron` 开发可以主要分成三部分来看。

**第一部分：渲染进程**

渲染进程的开发其实就是属于传统前端的开发范畴了，没什么太多的技术复杂度，你可以用你最拿手的框架和组件库快速搭建起一个桌面端界面，当然这也是 Electron 核心优势之一。

**第二部分：主进程**

主进程的开发核心就是需要理解和学习一些关于 `Electron API` 的东西，这部分东西你可以通过阅读官方文档来了解个大概。其他的就需要你投入实际开发来慢慢把握分寸了，因为代码这个东西，只有你遇到了才会有更深刻的理解。

小册的部分关于主进程的内容和 `Electron API` 的介绍是有参考过官方文档，不过这些内容都注入了作者开发 Electron 项目的心得在其中，希望可以让小伙伴们少走弯路。

**第三部分：原生能力扩展**

当你因为 `Electron` 的快速上手而投入实际桌面端应用开发后，如果碰到了 `Electron API` 无法支持的一些元素能力的诉求时，这个时候是最头大的。但 `80%` 的通常都有解法，因为 `Electron` 体量足够大，社区解决方案也足够多，这也是选择 `Electron` 的另一个非常重要的原因。

所以，碰到这类问题，一方面你可以通过社区求助，你碰到的问题，大部分都有解决方案，而且也会有些开源的原生扩展库提供使用。

如果你发现社区不提供解决方案，这个时候如果你有 `C++` 能力，那么你可以编写 `C++` 扩展。如果你是个纯前端，之前也没有接触过这些语言，那么强烈推荐可以入门一下 `Rust`。因为你学习了它，进可以通过 `tauri` 来重构项目，退可以将一些 `Electron` 比较耗内存和性能的代码通过 `Rust` 重构。

总的来说，学好第一、二部分，你可以解决 `80%` 的桌面端应用的需求。还有 `20%` 依然需要你掌握一门高级语言。（不过现在有 Chatgpt，你可以把你想要的功能告诉他，他会用对于的语言帮你实现~）



## 最后

小册实战部分涉及到了 `Rubick` 的源码，也有小伙伴反馈文章只是展示了部分示例代码，一方面无法单独运行，另一方面很难 `Get` 到具体的代码含义。针对这类问题，我是有计划弄一个 `mini Rubick` 出来，尽量简化一些边边角角的功能，让大家可以更容易理解和使用。

不过，这需要一段时间，先立个 `flag` 🚩。争取今年年中出来，到时候会更新小册~







