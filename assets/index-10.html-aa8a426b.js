import{_ as e,M as o,p as c,q as i,R as n,t as s,N as p,a1 as a}from"./framework-e8cb8151.js";const u={},l=a(`<h1 id="_10-vue3-框架升级-大型前端项目-vue2-升级-vue3-实战" tabindex="-1"><a class="header-anchor" href="#_10-vue3-框架升级-大型前端项目-vue2-升级-vue3-实战" aria-hidden="true">#</a> 10-Vue3 框架升级: 大型前端项目 Vue2 升级 Vue3 实战</h1><h2 id="_01-为什么要升级-vue3——vue3-与-vue2-对比" tabindex="-1"><a class="header-anchor" href="#_01-为什么要升级-vue3——vue3-与-vue2-对比" aria-hidden="true">#</a> 01：为什么要升级 vue3——vue3 与 vue2 对比</h2><h3 id="vue3-和-vue2-的对比" tabindex="-1"><a class="header-anchor" href="#vue3-和-vue2-的对比" aria-hidden="true">#</a> Vue3 和 Vue2 的对比</h3><h4 id="vue2-的缺陷" tabindex="-1"><a class="header-anchor" href="#vue2-的缺陷" aria-hidden="true">#</a> vue2 的缺陷</h4><ul><li>vue2 代码复用困难，vue2 的代码复用方式有 Mixin，但是容易出现命名冲突，且无法解决业务逻辑复用</li><li>Vue2 对于 TypeScript 的支持不足</li><li>Vue2 内部过度依赖 this, 导致无法 treeshaking</li></ul><h4 id="vue3-的优势" tabindex="-1"><a class="header-anchor" href="#vue3-的优势" aria-hidden="true">#</a> vue3 的优势</h4><ul><li>vue3 支持 vue2 的大多数特性，能够实现对 vue2 的向下兼容</li><li>vue3 对比 vue2 具有明显的性能提升 <ul><li>打包大小减少 41%</li><li>初次渲染快 55% 更新快 133%</li><li>内存使用减少 54%</li></ul></li><li>vue3 具有 composition API 实现逻辑块化和重用</li><li>vue3.2 通过 setup 语法糖进一步简化开发，可以编写更加优雅的代码</li><li>vue3 脚手架默认实现对 typeScript 的支持</li><li>增加了很多新特性，如 Fragment、Teleport、Suspense</li></ul><h2 id="_02-vue3-升级流程分析-vue3-依赖升级" tabindex="-1"><a class="header-anchor" href="#_02-vue3-升级流程分析-vue3-依赖升级" aria-hidden="true">#</a> 02：vue3 升级流程分析+vue3 依赖升级</h2><h2 id="_03-vue2-elm-项目启动脚本升级" tabindex="-1"><a class="header-anchor" href="#_03-vue2-elm-项目启动脚本升级" aria-hidden="true">#</a> 03：vue2-elm 项目启动脚本升级</h2><h2 id="_04-项目-vue3-升级后编译错误的解决" tabindex="-1"><a class="header-anchor" href="#_04-项目-vue3-升级后编译错误的解决" aria-hidden="true">#</a> 04：项目 vue3 升级后编译错误的解决</h2><h3 id="vue-全家桶依赖升级" tabindex="-1"><a class="header-anchor" href="#vue-全家桶依赖升级" aria-hidden="true">#</a> vue 全家桶依赖升级</h3><ol><li><p>删除项目中原有 vue 全家桶依赖：删除原项目中的 package.json 中的 vue 全家桶依赖</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token string-property property">&quot;vue&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.1.0&quot;</span><span class="token punctuation">,</span>
<span class="token string-property property">&quot;vue-router&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.1.1&quot;</span><span class="token punctuation">,</span>
<span class="token string-property property">&quot;vuex&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.0.0&quot;</span>

<span class="token comment">// 或者也可以执行以下命令</span>
npm uninstall vue vue<span class="token operator">-</span>router vuex
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>升级 vue 全家桶依赖，替换 vue3 版本的依赖</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token string-property property">&quot;vue&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.0.0&quot;</span><span class="token punctuation">,</span>
<span class="token string-property property">&quot;vue-router&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.0.0-0&quot;</span><span class="token punctuation">,</span>
<span class="token string-property property">&quot;vuex&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.0.0&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>配置 vue3 所需要的依赖(把原有 devDependencies 全部删除), 并<strong>修改执行脚本</strong></p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;@vue/cli-service&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^5.0.8&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@vue/compiler-sfc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.2.47&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;sass&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.62.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;sass-loader&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^13.2.2&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;better-scroll&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.5.1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;showdown&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.1.0&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vue-cli-service serve&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vue-cli-service build&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>安装项目依赖</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>执行脚本命令</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> run dev
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>修改项目文件引用地址：启动项目后根据报错信息修改项目文件中的引用地址</p><blockquote><p>原项目寻找文件是直接从 src 下寻找的，直接使用会报错需要修改成相对路径。不能够直接替换，需要根据使用文件的位置进行修改 These dependencies were not found</p></blockquote></li></ol><ul><li><div class="language-scss line-numbers-mode" data-ext="scss"><pre class="language-scss"><code> <span class="token keyword">@include</span> <span class="token function">fj</span><span class="token punctuation">(</span>left<span class="token punctuation">)</span> <span class="token selector">p </span><span class="token punctuation">{</span> <span class="token comment">// 此处报错</span>
  <span class="token property">text-align</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span>
  <span class="token property">line-height</span><span class="token punctuation">:</span> 1.39rem<span class="token punctuation">;</span>
  <span class="token keyword">@include</span> <span class="token function">sc</span><span class="token punctuation">(</span>0.7rem<span class="token punctuation">,</span> #999<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">margin-right</span><span class="token punctuation">:</span> 0.2rem<span class="token punctuation">;</span>
  <span class="token property">font-weight</span><span class="token punctuation">:</span> 100<span class="token punctuation">;</span>
  <span class="token property">font-family</span><span class="token punctuation">:</span> Arial<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
 
<span class="token comment">// 改为</span>
 <span class="token keyword">@include</span> <span class="token function">fj</span><span class="token punctuation">(</span>left<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token selector">p </span><span class="token punctuation">{</span>
  ...
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// Can&#39;t resolve &#39;src/config/env&#39; in &#39;/Users/yuangao/Desktop/vue2-elm-master/src/store&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>上个错误就是别名的一个错误，我们需要移植<code>build/webpack.base.config.js</code>中的 resolve 别名配置</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code>resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
  extensions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.js&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.vue&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.less&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.css&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.scss&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  fallback<span class="token operator">:</span> <span class="token punctuation">[</span>path.join(__dirname<span class="token punctuation">,</span> <span class="token string">&quot;../node_modules&quot;</span>)<span class="token punctuation">]</span><span class="token punctuation">,</span>
  alias<span class="token operator">:</span> <span class="token punctuation">{</span>
    vue$<span class="token operator">:</span> <span class="token string">&quot;vue/dist/vue.common.js&quot;</span><span class="token punctuation">,</span>
    src<span class="token operator">:</span> path.resolve(__dirname<span class="token punctuation">,</span> <span class="token string">&quot;../src&quot;</span>)<span class="token punctuation">,</span>
    assets<span class="token operator">:</span> path.resolve(__dirname<span class="token punctuation">,</span> <span class="token string">&quot;../src/assets&quot;</span>)<span class="token punctuation">,</span>
    components<span class="token operator">:</span> path.resolve(__dirname<span class="token punctuation">,</span> <span class="token string">&quot;../src/components&quot;</span>)<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>新建<code>vue.config.js</code>,把上述 <code>resolve</code> 配置粘贴进入</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">var</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">configureWebpack</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">extensions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;.js&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;.vue&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;.less&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;.css&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;.scss&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">src</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;./src&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 注意这里路径有所更改</span>
        <span class="token literal-property property">assets</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;./src/assets&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 注意这里路径有所更改</span>
        <span class="token literal-property property">components</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;./src/components&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 注意这里路径有所更改</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>这一次有新的报错</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code>at /Users/yuangao/Desktop/vue2-elm-master/src/components/common/shoplist.vue<span class="token operator">:</span><span class="token number">10</span><span class="token operator">:</span><span class="token number">60</span>
<span class="token number">8</span>  |  				&lt;hgroup class=<span class="token string">&quot;shop_right&quot;</span>&gt;
<span class="token number">9</span>  |  					&lt;header class=<span class="token string">&quot;shop_detail_header&quot;</span>&gt;
<span class="token number">10</span> |  						&lt;h4 <span class="token operator">:</span>class=<span class="token string">&quot;item.is_premium? &#39;premium&#39;: &#39;&#39;&quot;</span> class=<span class="token string">&quot;&quot;</span> class=<span class="token string">&quot;shop_title ellipsis&quot;</span>&gt;<span class="token punctuation">{</span><span class="token punctuation">{</span>item.name<span class="token punctuation">}</span><span class="token punctuation">}</span>&lt;/h4&gt;
   |                                                             ^
<span class="token number">11</span> |  						&lt;ul class=<span class="token string">&quot;shop_detail_ul&quot;</span>&gt;
<span class="token number">12</span> |  							&lt;li v-for=<span class="token property">&quot;item in item.supports&quot;</span> <span class="token operator">:</span>key=<span class="token string">&quot;item.id&quot;</span> class=<span class="token string">&quot;supports&quot;</span>&gt;<span class="token punctuation">{</span><span class="token punctuation">{</span>item.icon_name<span class="token punctuation">}</span><span class="token punctuation">}</span>&lt;/li&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>打开<code>src/components/common/shoplist</code>文件，可以看到他是有两个<code>class</code>属性，删除一个即可</p></li><li><p>再次运行<code>npm run dev</code>，发现编译成功，接下里我们解决语法上的错误</p></li></ul><h2 id="_05-vue-router-和-vuex-语法升级" tabindex="-1"><a class="header-anchor" href="#_05-vue-router-和-vuex-语法升级" aria-hidden="true">#</a> 05：vue-router 和 vuex 语法升级</h2><ol><li><p>修改<code>main.js</code>中<code>vue-router</code>引用方式, 改为如下方式</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span> <span class="token comment">// vue 引入方式发生改变</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createRouter<span class="token punctuation">,</span> createWebHistory <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue-router&quot;</span><span class="token punctuation">;</span> <span class="token comment">// vue-router 引入方式也有改变</span>
<span class="token keyword">import</span> routes <span class="token keyword">from</span> <span class="token string">&quot;./router/router&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">&quot;./store/&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&quot;./config/rem&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 引入 App.vue</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">&quot;./App.vue&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// router 的产生也发生了变化</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">createRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">history</span><span class="token operator">:</span> <span class="token function">createWebHistory</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">BASE_URL</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  routes<span class="token punctuation">,</span>
  <span class="token literal-property property">strict</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">&quot;production&quot;</span><span class="token punctuation">,</span>
  <span class="token function">scrollBehavior</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> savedPosition</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>savedPosition<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> savedPosition<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>from<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>keepAlive<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        from<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>savedPosition <span class="token operator">=</span> document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>scrollTop<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> to<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>savedPosition <span class="token operator">||</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 实例的调用方式也有改变</span>
<span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>store<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">&quot;#app&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>接着我们更改<code>store/index.js</code>,更新结果如下</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vuex&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> mutations <span class="token keyword">from</span> <span class="token string">&quot;./mutations&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> actions <span class="token keyword">from</span> <span class="token string">&quot;./action&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> getters <span class="token keyword">from</span> <span class="token string">&quot;./getters&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  state<span class="token punctuation">,</span>
  getters<span class="token punctuation">,</span>
  actions<span class="token punctuation">,</span>
  mutations<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>Appv.vue</code>更改为如下</p><blockquote><p>报错信息如下</p><p>vue-router.mjs?23bd:35 [Vue Router warn]: &lt;router-view&gt; can no longer be used directly inside &lt;transition&gt; or &lt;keep-alive&gt;</p></blockquote><div class="language-vue line-numbers-mode" data-ext="vue"><pre class="language-vue"><code>// 更改为如下包裹方式
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-view</span> <span class="token attr-name">v-slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{ Component }<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>keep-alive</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>$route.meta.keepAlive<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name">:is</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Component<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>keep-alive</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>router-fade<span class="token punctuation">&quot;</span></span> <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>out-in<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name">:is</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Component<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg-icon</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>svg-icon</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>router.js</code>中有报错，需要更改</p><p>报错信息如下</p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8fa1871041074148823d02c3f8e81f8f~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><p>修改为如下方式</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 引入方式统一改为如下方式</span>
<span class="token keyword">const</span> <span class="token function-variable function">home</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&quot;../page/home/home.vue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">...</span><span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>目前可以看到页面已经可以显示，虽然有些错误</p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/34c82cbe8b82490d8d3cd6f3bbed97b5~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p></li></ol><h2 id="_06-接口升级-图片链接升级" tabindex="-1"><a class="header-anchor" href="#_06-接口升级-图片链接升级" aria-hidden="true">#</a> 06：接口升级+图片链接升级</h2><ol><li><p>修改<code>src/config/fetch.js</code>中的借口地址</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 40 行改为如下 </span>
<span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&quot;http://cangdu.org:8001&quot;</span> <span class="token operator">+</span> url<span class="token punctuation">,</span> requestConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>这样回到浏览器就可以看到页面中已经正常请求返回</p></li><li><p>下面我们来处理图片的一个请求错误问题</p></li><li><p>打开<code>src/config/env.js</code>可以看到这里配置了图片地址（根据不同的环境返回不同的配置）,更改为如下</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">==</span> <span class="token string">&quot;development&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// imgBaseUrl = &quot;/img/&quot;;</span>
  imgBaseUrl <span class="token operator">=</span> <span class="token string">&quot;//elm.cangdu.org/img/&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 把本地的图片改为线上</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">==</span> <span class="token string">&quot;production&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  baseUrl <span class="token operator">=</span> <span class="token string">&quot;//elm.cangdu.org&quot;</span><span class="token punctuation">;</span>
  imgBaseUrl <span class="token operator">=</span> <span class="token string">&quot;//elm.cangdu.org/img/&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>目前图片就可以正常渲染了</p></li><li><p>接着我们回到首页<code>http://localhost:8081/home</code>可以看到，首页的一个样式有所丢失导致页面渲染效果不对</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code>// 页面中显示
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>citylistul clear<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-link</span>
    <span class="token attr-name">tag</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>li<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item in hotcity<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">:to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&#39;</span>/city/&#39; + item.id<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.id<span class="token punctuation">&quot;</span></span>
  <span class="token punctuation">&gt;</span></span>
    {{ item.name }}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-link</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里我们看到<code>router-link</code>写了一个<code>tag=&quot;li&quot;</code>属性，在旧版本中是会渲染成<code>li</code>标签的，旧版本中对应的<code>css</code>也是依照这个逻辑</p><div class="language-scss line-numbers-mode" data-ext="scss"><pre class="language-scss"><code><span class="token selector">.citylistul </span><span class="token punctuation">{</span>
  <span class="token selector">li </span><span class="token punctuation">{</span>
    <span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span>
    <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
    <span class="token property">color</span><span class="token punctuation">:</span> <span class="token variable">$blue</span><span class="token punctuation">;</span>
    <span class="token property">border-bottom</span><span class="token punctuation">:</span> 0.025rem solid <span class="token variable">$bc</span><span class="token punctuation">;</span>
    <span class="token property">border-right</span><span class="token punctuation">:</span> 0.025rem solid <span class="token variable">$bc</span><span class="token punctuation">;</span>
    <span class="token keyword">@include</span> <span class="token function">wh</span><span class="token punctuation">(</span>25%<span class="token punctuation">,</span> 1.75rem<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">@include</span> <span class="token function">font</span><span class="token punctuation">(</span>0.6rem<span class="token punctuation">,</span> 1.75rem<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token property">li</span><span class="token punctuation">:</span><span class="token function">nth-of-type</span><span class="token punctuation">(</span>4n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token property">border-right</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>但是目前在新版本中查看浏览器可以看到，渲染的是一个<code>a</code>标签</p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e337caef235f4e09aada892e689e26e2~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><p>所以需要进行更改<code>css</code>中的<code>li</code>问<code>a</code>即可</p><div class="language-scss line-numbers-mode" data-ext="scss"><pre class="language-scss"><code><span class="token selector">.citylistul </span><span class="token punctuation">{</span>
  <span class="token selector">a </span><span class="token punctuation">{</span> ... <span class="token punctuation">}</span>
  <span class="token property">a</span><span class="token punctuation">:</span><span class="token function">nth-of-type</span><span class="token punctuation">(</span>4n<span class="token punctuation">)</span> <span class="token punctuation">{</span> ... <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这样首页渲染效果就正常了</p></li></ol><h2 id="_07-首页-vue3-语法升级" tabindex="-1"><a class="header-anchor" href="#_07-首页-vue3-语法升级" aria-hidden="true">#</a> 07：首页 vue3 语法升级</h2><ol><li><p>目前首页的<code>js</code>代码还是按照之前的老的方式<code>data、methods、components</code>等等方式，</p></li><li><p>接下来我们使用<code>vue3</code>的新语法特性<code>setup</code>来进行改造</p><div class="language-vue line-numbers-mode" data-ext="vue"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> ref<span class="token punctuation">,</span> computed<span class="token punctuation">,</span> onMounted<span class="token punctuation">,</span> reactive <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> headTop <span class="token keyword">from</span> <span class="token string">&quot;../../components/header/head&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  cityGuess<span class="token punctuation">,</span>
  hotcity <span class="token keyword">as</span> hotcityApi<span class="token punctuation">,</span>
  groupcity <span class="token keyword">as</span> groupcityApi<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../../service/getData&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    headTop<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> guessCity <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//当前城市</span>
    <span class="token keyword">const</span> guessCityid <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//当前城市id</span>
    <span class="token keyword">let</span> hotcity <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//热门城市列表</span>
    <span class="token keyword">const</span> groupcity <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//所有城市列表</span>
    <span class="token comment">//将获取的数据按照A-Z字母开头排序</span>
    <span class="token keyword">const</span> sortgroupcity <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> sortobj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">65</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">90</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>groupcity<span class="token punctuation">.</span>value<span class="token punctuation">[</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          sortobj<span class="token punctuation">[</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span>
            groupcity<span class="token punctuation">.</span>value<span class="token punctuation">[</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> sortobj<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 获取当前城市</span>
      <span class="token function">cityGuess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        guessCity<span class="token punctuation">.</span>value <span class="token operator">=</span> res<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
        guessCityid<span class="token punctuation">.</span>value <span class="token operator">=</span> res<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">//获取热门城市</span>
      <span class="token function">hotcityApi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        hotcity <span class="token operator">=</span> res<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">//获取所有城市</span>
      <span class="token function">groupcityApi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        groupcity<span class="token punctuation">.</span>value <span class="token operator">=</span> res<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">reload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      window<span class="token punctuation">.</span>location<span class="token punctuation">.</span><span class="token function">reload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      guessCity<span class="token punctuation">,</span>
      guessCityid<span class="token punctuation">,</span>
      hotcity<span class="token punctuation">,</span>
      groupcity<span class="token punctuation">,</span>
      sortgroupcity<span class="token punctuation">,</span>
      reload<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h2 id="_08-vuex-和-vue-router-移植要点解析" tabindex="-1"><a class="header-anchor" href="#_08-vuex-和-vue-router-移植要点解析" aria-hidden="true">#</a> 08：vuex 和 vue-router 移植要点解析</h2>`,20),r=n("li",null,[n("p",null,[s("这里可以参照之前的"),n("code",null,"main.js"),s("中引入"),n("code",null,"vue-router"),s("、"),n("code",null,"vuex"),s("，以及"),n("code",null,"router.js"),s("、"),n("code",null,"store.js"),s("作为参考")])],-1),k=n("code",null,"vuex",-1),d=n("code",null,"store",-1),v={href:"https://vuex.vuejs.org/zh/guide/composition-api.html",target:"_blank",rel:"noopener noreferrer"},m=a(`<div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vuex&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">useStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1),b=n("code",null,"vue-router",-1),g={href:"https://router.vuejs.org/zh/guide/advanced/composition-api.html",target:"_blank",rel:"noopener noreferrer"},y=a(`<div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useRouter<span class="token punctuation">,</span> useRoute <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue-router&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">useRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> route <span class="token operator">=</span> <span class="token function">useRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">function</span> <span class="token function">pushWithQuery</span><span class="token punctuation">(</span><span class="token parameter">query</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;search&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">query</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token operator">...</span>route<span class="token punctuation">.</span>query<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1),h=a(`<h2 id="_09-vue3-2-setup-语法糖升级" tabindex="-1"><a class="header-anchor" href="#_09-vue3-2-setup-语法糖升级" aria-hidden="true">#</a> 09：vue3.2 setup 语法糖升级</h2><p>Vue 3.2 以后增加了 setup 语法糖，首页语法可以更改为如下</p><div class="language-vue line-numbers-mode" data-ext="vue"><pre class="language-vue"><code>// script 标签中增加 setup 属性，代表使用 setupy 语法糖特性
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> ref<span class="token punctuation">,</span> computed<span class="token punctuation">,</span> onMounted<span class="token punctuation">,</span> reactive <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> headTop <span class="token keyword">from</span> <span class="token string">&quot;../../components/header/head&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  cityGuess<span class="token punctuation">,</span>
  hotcity <span class="token keyword">as</span> hotcityApi<span class="token punctuation">,</span>
  groupcity <span class="token keyword">as</span> groupcityApi<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../../service/getData&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> guessCity <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//当前城市</span>
<span class="token keyword">const</span> guessCityid <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//当前城市id</span>
<span class="token keyword">let</span> hotcity <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//热门城市列表</span>
<span class="token keyword">const</span> groupcity <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//所有城市列表</span>
<span class="token comment">//将获取的数据按照A-Z字母开头排序</span>
<span class="token keyword">const</span> sortgroupcity <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> sortobj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">65</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">90</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>groupcity<span class="token punctuation">.</span>value<span class="token punctuation">[</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      sortobj<span class="token punctuation">[</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> groupcity<span class="token punctuation">.</span>value<span class="token punctuation">[</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> sortobj<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 获取当前城市</span>
  <span class="token function">cityGuess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    guessCity<span class="token punctuation">.</span>value <span class="token operator">=</span> res<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
    guessCityid<span class="token punctuation">.</span>value <span class="token operator">=</span> res<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//获取热门城市</span>
  <span class="token function">hotcityApi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    hotcity <span class="token operator">=</span> res<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//获取所有城市</span>
  <span class="token function">groupcityApi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    groupcity<span class="token punctuation">.</span>value <span class="token operator">=</span> res<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">reload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  window<span class="token punctuation">.</span>location<span class="token punctuation">.</span><span class="token function">reload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,3);function q(f,w){const t=o("ExternalLinkIcon");return c(),i("div",null,[l,n("ol",null,[r,n("li",null,[n("p",null,[k,s("中"),d,s("的获取，参考文档"),n("a",v,[s("https://vuex.vuejs.org/zh/guide/composition-api.html"),p(t)])]),m]),n("li",null,[n("p",null,[b,s("的获取参考文档"),n("a",g,[s("https://router.vuejs.org/zh/guide/advanced/composition-api.html"),p(t)])]),y])]),h])}const j=e(u,[["render",q],["__file","index-10.html.vue"]]);export{j as default};
