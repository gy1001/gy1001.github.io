import{_ as t,M as p,p as e,q as o,R as n,t as s,N as i,a1 as c}from"./framework-e8cb8151.js";const l={},u=c(`<h1 id="_20-抢先实战-进阶实战——vite-接入工程化脚手架" tabindex="-1"><a class="header-anchor" href="#_20-抢先实战-进阶实战——vite-接入工程化脚手架" aria-hidden="true">#</a> 20-抢先实战：进阶实战——Vite 接入工程化脚手架</h1><h2 id="_01-wp2vite-移植-zbestpc-项目工程化配置" tabindex="-1"><a class="header-anchor" href="#_01-wp2vite-移植-zbestpc-项目工程化配置" aria-hidden="true">#</a> 01: wp2vite 移植 zbestpc 项目工程化配置</h2><h3 id="wp2vite" tabindex="-1"><a class="header-anchor" href="#wp2vite" aria-hidden="true">#</a> wp2vite</h3><p>一个前端项目，可以让 webpack 项目支持 vite, wp2vite 不会删除你的项目中的 webpack 的配置文件，但是会在你的项目中插入 vite 的配置文件，相较于 webpack、vite开发环境构建速度提升 80% 左右，构建生产环境能够提升 50% 左右。目前已经被 vite 官方收录</p><h3 id="wp2vite-使用" tabindex="-1"><a class="header-anchor" href="#wp2vite-使用" aria-hidden="true">#</a> wp2vite 使用</h3><ol><li><p>全局安装 wp2vite</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-g</span> wp2vite
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>使用方式</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> yourwork/your_project // go to your project catalog
wp2vite
or 
wp2vite <span class="token parameter variable">--config</span><span class="token operator">=</span>./webpack.config.js // with config <span class="token function">file</span>
wp2vite <span class="token parameter variable">-v</span> // check wp2vite version
<span class="token function">npm</span> <span class="token function">install</span> // <span class="token function">install</span> dependencies
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h3 id="项目移植" tabindex="-1"><a class="header-anchor" href="#项目移植" aria-hidden="true">#</a> 项目移植</h3><ol><li><p>先全局安装<code>wp2vite</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-g</span> wp2vite
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>来到<code>https://github.com/gy1001/Vue-Related/tree/master/imooc-build/examples/zbestpc_update</code>这项目下</p></li><li><p>执行终端命令, 如下</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>gaoyuan@gaoyuandeMac zbestpc_update % wp2vite <span class="token parameter variable">-v</span>
wp2vite/2.0.9 darwin-x64 node-v16.16.0

gaoyuan@gaoyuandeMac zbestpc_update % wp2vite <span class="token parameter variable">--config</span> ./build/webpack.config.js
<span class="token punctuation">[</span>wp2vite-env<span class="token punctuation">]</span>:开始分析项目属性
<span class="token punctuation">[</span>wp2vite-env<span class="token punctuation">]</span>:项目属性分析完成
<span class="token punctuation">[</span>wp2vite-start<span class="token punctuation">]</span>:开始转换项目
<span class="token punctuation">[</span>wp2vite-start<span class="token punctuation">]</span>:wp2vite 认为是*Vue3*项目
<span class="token punctuation">[</span>wp2vite-alias<span class="token punctuation">]</span>:根据webpack配置文件处理alias
<span class="token punctuation">[</span>wp2vite-entry<span class="token punctuation">]</span>:根据webpack的配置获取入口
<span class="token punctuation">[</span>wp2vite-entry<span class="token punctuation">]</span>:入口获取完成，入口为: /src/index.js,/src/login.js
<span class="token punctuation">[</span>wp2vite-html<span class="token punctuation">]</span>:将入口写入到html文件
<span class="token punctuation">[</span>wp2vite-html<span class="token punctuation">]</span>:html处理完成
<span class="token punctuation">[</span>wp2vite-vite<span class="token punctuation">]</span>:将import写入到vite的配置文件
<span class="token punctuation">[</span>wp2vite-vite<span class="token punctuation">]</span>:将alias写入到vite的配置文件
<span class="token punctuation">[</span>wp2vite-vite<span class="token punctuation">]</span>:将proxy写入到vite的配置文件
<span class="token punctuation">[</span>wp2vite-vite<span class="token punctuation">]</span>:将esbuild写入到vite的配置文件
<span class="token punctuation">[</span>wp2vite-vite<span class="token punctuation">]</span>:将define写入到vite的配置文件
<span class="token punctuation">[</span>wp2vite-vite<span class="token punctuation">]</span>:将plugin写入到vite的配置文件
<span class="token punctuation">[</span>wp2vite-vite<span class="token punctuation">]</span>:将optimizeDeps写入到vite的配置文件
<span class="token punctuation">[</span>wp2vite-vite<span class="token punctuation">]</span>:将rollupOptions写入到vite的配置文件
<span class="token punctuation">[</span>wp2vite-vite<span class="token punctuation">]</span>:汇总并写入到vite.config.js
<span class="token punctuation">[</span>wp2vite-pack<span class="token punctuation">]</span>:依赖写入
<span class="token punctuation">[</span>wp2vite-pack<span class="token punctuation">]</span>:依赖写入完成
<span class="token punctuation">[</span>wp2vite-start<span class="token punctuation">]</span>:项目转换完成
<span class="token punctuation">[</span>wp2vite-todo<span class="token punctuation">]</span>:npm <span class="token function">install</span> <span class="token operator">&amp;&amp;</span> <span class="token function">npm</span> run vite-start
<span class="token punctuation">[</span>wp2vite-todo<span class="token punctuation">]</span>:前往 https://github.com/vitejs/awesome-vite 查看你可能需要的插件
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>完成可见到，有以下文件改动</p><ul><li><p>新建<code>index.html</code>至根目录</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>utf-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>最家<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/src/index.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/src/login.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>新建<code>vite.config.js</code>至根目录</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">/* eslint-disable */</span>
<span class="token keyword">import</span> legacyPlugin <span class="token keyword">from</span> <span class="token string">&#39;@vitejs/plugin-legacy&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> path <span class="token keyword">from</span> <span class="token string">&#39;path&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> vuePlugin <span class="token keyword">from</span> <span class="token string">&#39;@vitejs/plugin-vue&#39;</span><span class="token punctuation">;</span>
<span class="token comment">// @see https://cn.vitejs.dev/config/</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>
  command<span class="token punctuation">,</span>
  mode
<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> rollupOptions <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>


  <span class="token keyword">let</span> optimizeDeps <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>


  <span class="token keyword">let</span> alias <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token keyword">let</span> proxy <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token comment">// todo 替换为原有变量</span>
  <span class="token keyword">let</span> define <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&#39;p<wbr>rocess.env.NODE_ENV&#39;</span><span class="token operator">:</span> command <span class="token operator">===</span> <span class="token string">&#39;serve&#39;</span> <span class="token operator">?</span> <span class="token string">&#39;&quot;development&quot;&#39;</span> <span class="token operator">:</span> <span class="token string">&#39;&quot;production&quot;&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">let</span> esbuild <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">base</span><span class="token operator">:</span> <span class="token string">&#39;./&#39;</span><span class="token punctuation">,</span> <span class="token comment">// index.html文件所在位置</span>
    <span class="token literal-property property">root</span><span class="token operator">:</span> <span class="token string">&#39;./&#39;</span><span class="token punctuation">,</span> <span class="token comment">// js导入的资源路径，src</span>
    <span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      alias<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">define</span><span class="token operator">:</span> define<span class="token punctuation">,</span>
    <span class="token literal-property property">server</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// 代理</span>
      proxy<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">build</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token string">&#39;es2015&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">minify</span><span class="token operator">:</span> <span class="token string">&#39;terser&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 是否进行压缩,boolean | &#39;terser&#39; | &#39;esbuild&#39;,默认使用terser</span>
      <span class="token literal-property property">manifest</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 是否产出maifest.json</span>
      <span class="token literal-property property">sourcemap</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 是否产出soucemap.json</span>
      <span class="token literal-property property">outDir</span><span class="token operator">:</span> <span class="token string">&#39;build&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 产出目录</span>
      rollupOptions<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    esbuild<span class="token punctuation">,</span>
    optimizeDeps<span class="token punctuation">,</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token function">legacyPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">targets</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;Android &gt; 39&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Chrome &gt;= 60&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Safari &gt;= 10.1&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;iOS &gt;= 10.3&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Firefox &gt;= 54&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Edge &gt;= 15&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">vuePlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">css</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">preprocessorOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">less</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token comment">// 支持内联 JavaScript</span>
          <span class="token literal-property property">javascriptEnabled</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>新增加响应脚本以及依赖库，<code>package.json</code>中的变动</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    ... 
  	<span class="token property">&quot;vite-dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vite&quot;</span><span class="token punctuation">,</span>
		<span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vite&quot;</span><span class="token punctuation">,</span>
		<span class="token property">&quot;preview&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vite preview&quot;</span><span class="token punctuation">,</span>
		<span class="token property">&quot;vite-build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vite build&quot;</span>  
  <span class="token punctuation">}</span>
  <span class="token property">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  	...
    <span class="token property">&quot;vite&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span>
		<span class="token property">&quot;@vitejs/plugin-legacy&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.4.4&quot;</span><span class="token punctuation">,</span>
		<span class="token property">&quot;@vitejs/plugin-vue&quot;</span><span class="token operator">:</span> <span class="token string">&quot;latest&quot;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li><li><p>终端执行以下命令</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> 
<span class="token function">npm</span> run vite-dev
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>执行后，运行报错</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>failed to load config from /Users/gaoyuan/Documents/Code/learn/MyGithub/Vue-Related/imooc-build/examples/zbestpc_update/vite.config.js
error when starting dev server:
TypeError: vite.createFilter is not a <span class="token keyword">function</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>报错原因：vite版本与安装的依赖版本不匹配(我本地全局安装的是 3.0，这里项目安装的是 2.0)</p></li><li><p>执行以下命令</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-D</span> vite@^3
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>再次运行<code>npm run vite-dev</code>就可以看到，服务正常启动了</p></li><li><p>打开浏览器。报错信息如下</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>Uncaught ReferenceError: $ is not defined
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>我们下一节进行修复进行修复</p></li></ol><h2 id="_02-rollup-plugin-inject解决全局变量注入" tabindex="-1"><a class="header-anchor" href="#_02-rollup-plugin-inject解决全局变量注入" aria-hidden="true">#</a> 02：rollup-plugin-inject解决全局变量注入</h2><ol><li><p>安装插件，并添加配置</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> rollup-plugin-inject <span class="token parameter variable">-S</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>修改<code>vite.config.js</code>,添加如下配置</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> inject <span class="token keyword">from</span> <span class="token string">&quot;rollup-plugin-inject&quot;</span>

<span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token function">inject</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">$</span><span class="token operator">:</span> <span class="token string">&#39;jquery&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">jQuery</span><span class="token operator">:</span> <span class="token string">&#39;jquery&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>配置完成后，刷新页面，发现模板文件没有渲染，但是如果修改<code>src/index.js</code>中添加打印代码，可以在控制台中实时看到</p></li><li><p>注意安装时候提示</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ <span class="token function">pnpm</span> <span class="token function">install</span> rollup-plugin-inject <span class="token parameter variable">-S</span>
 WARN  deprecated rollup-plugin-inject@3.0.2: This package has been deprecated and is no longer maintained. Please use @rollup/plugin-inject.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>这里我们执行以下命令</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> uninstall rollup-plugin-inject
<span class="token function">npm</span> <span class="token function">install</span> @rollup/plugin-inject <span class="token parameter variable">-S</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>修改<code>vite.config.js</code>，修改如下</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// import inject from &quot;rollup-plugin-inject&quot;</span>
<span class="token keyword">import</span> inject <span class="token keyword">from</span> <span class="token string">&quot;@rollup/plugin-inject&quot;</span>
<span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token function">inject</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">$</span><span class="token operator">:</span> <span class="token string">&#39;jquery&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">jQuery</span><span class="token operator">:</span> <span class="token string">&#39;jquery&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>配置完成后，刷新页面，发现模板文件没有渲染，但是如果修改<code>src/index.js</code>中添加打印代码，可以在控制台中实时看到</p></li></ol><h2 id="_03-模板文件编译和注入" tabindex="-1"><a class="header-anchor" href="#_03-模板文件编译和注入" aria-hidden="true">#</a> 03：模板文件编译和注入</h2><ol><li><p>添加模板插件</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> vite-plugin-html <span class="token parameter variable">-D</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>修改<code>vite.config.js</code> ,引入插件</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createHtmlPlugin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vite-plugin-html&#39;</span>

<span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token function">createHtmlPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">&#39;./src/index.js&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">filname</span><span class="token operator">:</span> <span class="token string">&#39;index.html&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">&#39;index-vite.html&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>根目录下新建<code>index-vite.html</code>,把<code>public/index.html</code>文件内容拷贝进来，并导入相应<code>index.js</code></p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/src/index.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>项目中如果使用 ejs ，我们先把 ejs 中的模板拷贝进来，后续抽离为一个组件</p></li><li><p>目前运行终端，页面中显示了，但是图片都没有显示，可以修改一下图片地址，<code>img/</code>改为<code>../src/img/</code>,然后图片就可以正常显示了</p></li><li><p>执行<code>npm run vite-build</code>时候报错，</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>Error: Missing <span class="token string">&quot;./legacy-polyfills&quot;</span> <span class="token builtin class-name">export</span> <span class="token keyword">in</span> <span class="token string">&quot;vite&quot;</span> package
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>推测是版本依赖不一致,执行以下命令</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> uninstall @vitejs/plugin-legacy
<span class="token function">npm</span> <span class="token function">install</span> @vitejs/plugin-legacy <span class="token parameter variable">-D</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>修改<code>vite.config.js</code>中的打包输出路径</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token literal-property property">build</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">outDir</span><span class="token operator">:</span> <span class="token string">&#39;dist&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 产出目录</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>重新运行<code>npm run vite-build</code>发现打包成功</p></li></ol><h2 id="_04-vite-vue3项目移植" tabindex="-1"><a class="header-anchor" href="#_04-vite-vue3项目移植" aria-hidden="true">#</a> 04：vite+vue3项目移植</h2><h2 id="_05-工程化脚手架-build-命令开发" tabindex="-1"><a class="header-anchor" href="#_05-工程化脚手架-build-命令开发" aria-hidden="true">#</a> 05：工程化脚手架 build 命令开发</h2><ol><li><p>修改<code>imooc-build/lib/build/buildServer.js</code>中的代码，修改如下</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> Service <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;../service/Service&#39;</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token parameter">arg<span class="token punctuation">,</span> opts<span class="token punctuation">,</span> cmd</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">customWebpackPath</span><span class="token operator">:</span> arg<span class="token punctuation">.</span>customWebpackPath <span class="token operator">||</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">stopServer</span><span class="token operator">:</span> <span class="token operator">!</span><span class="token operator">!</span>arg<span class="token punctuation">.</span>stopServer<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">=</span> <span class="token string">&#39;production&#39;</span>
  <span class="token keyword">const</span> service <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Service</span><span class="token punctuation">(</span><span class="token string">&#39;build&#39;</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span>
  service<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>修改<code>service/Service.js</code>，增加如下代码</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Service</span> <span class="token punctuation">{</span>
  
  <span class="token keyword">async</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resolveConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">registerWebpackConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">registerHooks</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emitHooks</span><span class="token punctuation">(</span><span class="token constant">HOOK_START</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">registerPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">runPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>args<span class="token punctuation">.</span>stopServer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initWebpack</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">doBuileService</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">doBuileService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> compiler
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> selfWebapck <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>webpack<span class="token punctuation">)</span>
      <span class="token keyword">const</span> webpackConfig <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>webpackConfig<span class="token punctuation">.</span><span class="token function">toConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      compiler <span class="token operator">=</span> <span class="token function">selfWebapck</span><span class="token punctuation">(</span>webpackConfig<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> stats</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;ERROR!&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> result <span class="token operator">=</span> stats<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">all</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token literal-property property">errors</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token literal-property property">warnings</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token literal-property property">timings</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>errors <span class="token operator">&amp;&amp;</span> result<span class="token punctuation">.</span>errors<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;COMPILE ERROR&#39;</span><span class="token punctuation">)</span>
            result<span class="token punctuation">.</span>errors<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;ERROR MESSAGE: &#39;</span><span class="token punctuation">,</span> error<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>warnings <span class="token operator">&amp;&amp;</span> result<span class="token punctuation">.</span>warnings<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&#39;COMPILE WARNING&#39;</span><span class="token punctuation">)</span>
            result<span class="token punctuation">.</span>warnings<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">warning</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&#39;WARNING MESSAGE: &#39;</span><span class="token punctuation">,</span> warning<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>
              <span class="token string">&#39;COMPILE SUCCESSFULLY!&#39;</span><span class="token punctuation">,</span>
              <span class="token string">&#39;Compile finish in &#39;</span> <span class="token operator">+</span> result<span class="token punctuation">.</span>time <span class="token operator">/</span> <span class="token number">1000</span> <span class="token operator">+</span> <span class="token string">&#39;s&#39;</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;service startServer&#39;</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>修改<code>imooc-build/examples/zbestpc_update/package.json</code>文件，增加打包命令</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;build:imooc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;imooc-build build&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>在<code>examples/zbestpc_update</code>中运行终端命令<code>npm run build:imooc</code>即可看到产生了<code>dist</code>文件夹</p></li></ol><h2 id="_06-zbestpc项目build命令改造" tabindex="-1"><a class="header-anchor" href="#_06-zbestpc项目build命令改造" aria-hidden="true">#</a> 06：zbestpc项目build命令改造</h2><h2 id="_07-工程化脚手架vite插件开发" tabindex="-1"><a class="header-anchor" href="#_07-工程化脚手架vite插件开发" aria-hidden="true">#</a> 07：工程化脚手架vite插件开发</h2>`,17),r={href:"https://cn.vitejs.dev/guide/api-javascript.html",target:"_blank",rel:"noopener noreferrer"},d=n("h2",{id:"_08-zbestpc项目移植imooc-build-vite脚手架",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_08-zbestpc项目移植imooc-build-vite脚手架","aria-hidden":"true"},"#"),s(" 08：zbestpc项目移植imooc-build+vite脚手架")],-1);function k(v,m){const a=p("ExternalLinkIcon");return e(),o("div",null,[u,n("p",null,[n("a",r,[s("参考文档：https://cn.vitejs.dev/guide/api-javascript.html"),i(a)])]),d])}const g=t(l,[["render",k],["__file","index-20.html.vue"]]);export{g as default};
