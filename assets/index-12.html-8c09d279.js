import{_ as t,M as o,p as i,q as c,R as n,t as s,N as e,a1 as p}from"./framework-e8cb8151.js";const l={},r=p(`<h1 id="_12-大型前端项目-尝鲜——webpack5-新特性通关" tabindex="-1"><a class="header-anchor" href="#_12-大型前端项目-尝鲜——webpack5-新特性通关" aria-hidden="true">#</a> 12-大型前端项目：尝鲜——Webpack5 新特性通关</h1><h2 id="_01-webpack4-和-5-构建结果对比" tabindex="-1"><a class="header-anchor" href="#_01-webpack4-和-5-构建结果对比" aria-hidden="true">#</a> 01: webpack4 和 5 构建结果对比</h2><p>我们创建两个项目<code>webpack4-demo</code>和 <code>webpack5-demo</code></p><h3 id="创建-webpack4-项目" tabindex="-1"><a class="header-anchor" href="#创建-webpack4-项目" aria-hidden="true">#</a> 创建 webpack4 项目</h3><ol><li><p>新建<code>demo1/webpack4-demo</code></p></li><li><p>执行以下命令</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> demo1/webpack4-demo
<span class="token function">npm</span> init <span class="token parameter variable">-y</span>
<span class="token function">npm</span> <span class="token function">install</span> webpack@4.46.0 webpack-cli@4.9.2 <span class="token parameter variable">-D</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>更新<code>packages.json</code>脚本命令</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>新建<code>src/index.js</code>,内容如下</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;hello webpack&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>新建配置文件<code>weback4-demo/webpack.config.js</code></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&#39;production&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">&#39;./src/index.js&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;dist&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;[name].js&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>执行<code>npm run dev</code>, 可能由于 node 版本过高而报错，建议使用 node 14 左右</p></li><li><p>可以看到<code>dist</code>目录下已经正常打包有文件产生了</p></li></ol><h3 id="创建-webpack5-项目" tabindex="-1"><a class="header-anchor" href="#创建-webpack5-项目" aria-hidden="true">#</a> 创建 webpack5 项目</h3><ol><li><p>通过 n 模块切换 node 版本为 16 左右的版本</p></li><li><p>新建<code>demo1/webpack5-demo</code></p></li><li><p>执行以下命令</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> demo1/webpack5-demo
<span class="token function">npm</span> init <span class="token parameter variable">-y</span>
<span class="token function">npm</span> <span class="token function">install</span> webpack webpack-cli <span class="token parameter variable">-D</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>更新<code>packages.json</code>脚本命令</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;scripts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;build&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;webpack&quot;</span>
  <span class="token punctuation">}</span>,
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>新建<code>src/index.js</code>,内容如下</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;hello webpack&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>新建配置文件<code>weback5-demo/webpack.config.js</code></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&#39;production&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">&#39;./src/index.js&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;dist&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;[name].js&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>执行<code>npm run build</code>,可以看到<code>dist</code>目录下已经正常打包有文件产生了</p></li></ol><h3 id="差异" tabindex="-1"><a class="header-anchor" href="#差异" aria-hidden="true">#</a> 差异</h3><table><thead><tr><th>种类</th><th>webpack4</th><th>webapck5</th></tr></thead><tbody><tr><td>dist/main.js 文件内容差异</td><td><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b5057ddcbc3f428a86e5f13650a1ea73~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></td><td><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7f1f99dd58cb4345a4281f32e2b85471~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></td></tr><tr><td>构建时间差异<br>(log 格式也异样）</td><td>Version: webpack <strong>4.46.0</strong>，<br> Time: <strong>47</strong>ms</td><td>webpack 5.79.0 compiled <strong>successfully</strong> in 161 ms</td></tr></tbody></table><h2 id="_02-webpack4-和-5-缓存特性对比" tabindex="-1"><a class="header-anchor" href="#_02-webpack4-和-5-缓存特性对比" aria-hidden="true">#</a> 02: webpack4 和 5 缓存特性对比</h2><blockquote><p>缓存一直是前端性能优化的重头戏，利用好静态资源的缓存机制，可以使我们的构建速度更快</p></blockquote><h3 id="webpack4-中" tabindex="-1"><a class="header-anchor" href="#webpack4-中" aria-hidden="true">#</a> webpack4 中</h3><p>目前<code>src/index.js</code>中内容较少，我们新安装一个 vue</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> installl vue <span class="token parameter variable">-D</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>修改<code>src/index.js</code>，内容如下</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;hello webpack&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span>
<span class="token function">createApp</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>重新执行<code>npm run build</code>可以看到<code>main.js</code>大小由<code>958 bytes</code>变为 61.4 KiB，说明 vue 内容被全部打包进去了</p><p>接着我们修改<code>webpack.config.js</code>内容</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
  <span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">splitChunks</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">minSize</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">,</span>
      <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">&#39;all&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;common&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>重新执行<code>npm run build</code>，可以看到<code>dist</code>目录下多了两个文件</p><ul><li>common.js 60.6kb</li><li>main.js 1.56kb</li></ul><p>接下来增加缓存配置，修改<code>webpack.config.js</code>内容</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
  <span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">splitChunks</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">minSize</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">,</span>
      <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">&#39;all&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;common&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">cache</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>第一次执行<code>npm run build</code>，打包日志如下(耗时 1505ms)</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>Hash: 4331f7fd8bd86e286a6d
Version: webpack <span class="token number">4.46</span>.0
Time: 1505ms
Built at: <span class="token number">2023</span>/04/17 下午4:44:21
    Asset      Size  Chunks             Chunk Names
common.js  <span class="token number">60.6</span> KiB       <span class="token number">0</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  common
  main.js  <span class="token number">1.56</span> KiB       <span class="token number">1</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  main
Entrypoint main <span class="token operator">=</span> common.js main.js
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>第二次执行<code>npm run build</code>，打包耗时(399ms)</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>Hash: 4331f7fd8bd86e286a6d
Version: webpack <span class="token number">4.46</span>.0
Time: 399ms
Built at: <span class="token number">2023</span>/04/17 下午4:44:38
    Asset      Size  Chunks             Chunk Names
common.js  <span class="token number">60.6</span> KiB       <span class="token number">0</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  common
  main.js  <span class="token number">1.56</span> KiB       <span class="token number">1</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  main
Entrypoint main <span class="token operator">=</span> common.js main.js

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>另外，可以看到<code>node_modules</code>下的缓存目录为</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/14aaa894b54845e7b49d9bb577c740cd~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><h3 id="webpack5-中" tabindex="-1"><a class="header-anchor" href="#webpack5-中" aria-hidden="true">#</a> webpack5 中</h3><p>同样新安装一个 vue</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> installl vue <span class="token parameter variable">-D</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>修改<code>src/index.js</code>，内容如下</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;hello webpack&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span>
<span class="token function">createApp</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>重新执行<code>npm run build</code>可以看到<code>main.js</code>大小由<code>29 bytes</code>变为<code> 55 KB</code>，说明 vue 内容被全部打包进去了</p><p>接着我们修改<code>webpack.config.js</code>内容</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
  <span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">splitChunks</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">minSize</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">,</span>
      <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">&#39;all&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;common&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>重新执行<code>npm run build</code>，可以看到<code>dist</code>目录下多了两个文件</p><ul><li>common.js 54.1kb</li><li>main.js 1.26kb</li></ul><p>接下来增加缓存配置，修改<code>webpack.config.js</code>内容</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
  <span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">splitChunks</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">minSize</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">,</span>
      <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">&#39;all&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;common&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// cache: true, 适合开发模式，</span>
  <span class="token comment">// cache: true, //cache: true 与 cache: { type: &#39;memory&#39; } 配置作用一致。 传入 false 会禁用缓存:</span>
	<span class="token comment">// 有了缓存，比如我们只修改了 main.js 有了缓存就不会重新打包所有的</span>
  <span class="token literal-property property">cache</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;filesystem&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>第一次执行<code>npm run build</code>，打包日志如下(耗时 1712 ms)</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>asset common.js <span class="token number">54.1</span> KiB <span class="token punctuation">[</span>compared <span class="token keyword">for</span> emit<span class="token punctuation">]</span> <span class="token punctuation">[</span>minimized<span class="token punctuation">]</span> <span class="token punctuation">(</span>name: common<span class="token punctuation">)</span> <span class="token punctuation">(</span>id hint: vendors<span class="token punctuation">)</span>
asset main.js <span class="token number">1.26</span> KiB <span class="token punctuation">[</span>compared <span class="token keyword">for</span> emit<span class="token punctuation">]</span> <span class="token punctuation">[</span>minimized<span class="token punctuation">]</span> <span class="token punctuation">(</span>name: main<span class="token punctuation">)</span>
Entrypoint main <span class="token number">55.4</span> KiB <span class="token operator">=</span> common.js <span class="token number">54.1</span> KiB main.js <span class="token number">1.26</span> KiB // 注意这里是打包后的文件大小
runtime modules <span class="token number">3</span> KiB <span class="token number">5</span> modules
orphan modules <span class="token number">375</span> KiB <span class="token punctuation">[</span>orphan<span class="token punctuation">]</span> <span class="token number">4</span> modules
cacheable modules <span class="token number">433</span> KiB
  ./src/index.js <span class="token number">76</span> bytes <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
  ./node_modules/@vue/runtime-dom/dist/runtime-dom.esm-bundler.js + <span class="token number">3</span> modules <span class="token number">433</span> KiB <span class="token punctuation">[</span>built<span class="token punctuation">]</span> <span class="token punctuation">[</span>code generated<span class="token punctuation">]</span>
webpack <span class="token number">5.79</span>.0 compiled successfully <span class="token keyword">in</span> <span class="token number">1712</span> ms
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>第二次执行<code>npm run build</code>，打包耗时(139 ms)，时间被大幅度缩减</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>asset common.js <span class="token number">54.1</span> KiB <span class="token punctuation">[</span>compared <span class="token keyword">for</span> emit<span class="token punctuation">]</span> <span class="token punctuation">[</span>minimized<span class="token punctuation">]</span> <span class="token punctuation">(</span>name: common<span class="token punctuation">)</span> <span class="token punctuation">(</span>id hint: vendors<span class="token punctuation">)</span>
asset main.js <span class="token number">1.26</span> KiB <span class="token punctuation">[</span>compared <span class="token keyword">for</span> emit<span class="token punctuation">]</span> <span class="token punctuation">[</span>minimized<span class="token punctuation">]</span> <span class="token punctuation">(</span>name: main<span class="token punctuation">)</span>
Entrypoint main <span class="token number">55.4</span> KiB <span class="token operator">=</span> common.js <span class="token number">54.1</span> KiB main.js <span class="token number">1.26</span> KiB // 注意这里是打包后的文件大小
cached modules <span class="token number">808</span> KiB <span class="token punctuation">(</span>javascript<span class="token punctuation">)</span> <span class="token number">3</span> KiB <span class="token punctuation">(</span>runtime<span class="token punctuation">)</span> <span class="token punctuation">[</span>cached<span class="token punctuation">]</span> <span class="token number">11</span> modules
webpack <span class="token number">5.79</span>.0 compiled successfully <span class="token keyword">in</span> <span class="token number">139</span> ms
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>另外，可以看到<code>node_modules</code>下的缓存目录如下</p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/aaaa49a060bb49ef82307be1f6d746b5~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><h3 id="对比总结" tabindex="-1"><a class="header-anchor" href="#对比总结" aria-hidden="true">#</a> 对比总结</h3><ul><li>webpack5 比 webpack4 的文件压缩策略更优，分割文件后的 vendor 体积缩小</li><li>webpack5 缓存构建性能优于 webpack4</li><li>webpack5 缓存的功能显著优于 webpack4</li></ul><h2 id="_03-webpack-缓存插件-hard-source-webpack-plugin" tabindex="-1"><a class="header-anchor" href="#_03-webpack-缓存插件-hard-source-webpack-plugin" aria-hidden="true">#</a> 03: webpack 缓存插件 hard-source-webpack-plugin</h2><p>cache 这个功能实在 webpack4 以后才产生的</p><p>而对于早期版本，如果想使用缓存，并且是物理缓存的话可以使用这个插件</p><p>从<code>vue-cli</code>和<code>create-react-app</code>中可以知道并没有实用 dll， 是因为：<strong>Webpack 4 的打包性能足够好的，dll 继续维护的必要了。</strong></p><p>更好的代替者<code>DLL，选择hard-source-webpack-plugin</code></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>npm install hard<span class="token operator">-</span>source<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin <span class="token operator">-</span><span class="token constant">D</span>

<span class="token keyword">const</span> HardSourceWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;hard-source-webpack-plugin&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ......</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HardSourceWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// &lt;- 直接加入这行代码就行</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li><p>我们在<code>webapck4-demo</code>中进行安装</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> hard-source-webpack-plugin <span class="token parameter variable">-D</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>我们先修改<code>packages.json</code>中的<code>cache</code>为 false,即：不使用缓存的情况下，看下这个打包的一个时间过程,并且删除<code>node_modules/.cache</code>目录</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&#39;production&#39;</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>
  <span class="token literal-property property">cache</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>重新执行<code>npm run build</code>，打印日志如下</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>Hash: 4331f7fd8bd86e286a6d
Version: webpack <span class="token number">4.46</span>.0
Time: 1664ms
Built at: <span class="token number">2023</span>/04/17 下午5:20:55
    Asset      Size  Chunks             Chunk Names
common.js  <span class="token number">60.6</span> KiB       <span class="token number">0</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  common
  main.js  <span class="token number">1.56</span> KiB       <span class="token number">1</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  main
Entrypoint main <span class="token operator">=</span> common.js main.js
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>再次执行<code>npm run build</code>,打印日志如下</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>Hash: 929d247d9241bcef072a
Version: webpack <span class="token number">4.46</span>.0
Time: 396ms
Built at: <span class="token number">2023</span>/04/17 下午5:24:18
    Asset      Size  Chunks             Chunk Names
common.js  <span class="token number">60.6</span> KiB       <span class="token number">0</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  common
  main.js  <span class="token number">1.56</span> KiB       <span class="token number">1</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  main
Entrypoint main <span class="token operator">=</span> common.js main.js
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>查看<code>node_modules/.cache</code>目录下已经产生了缓存目录(<code>/webpack4-demo/node_modules/.cache/terser-webpack-plugin</code>),有点奇怪，没有禁用掉，</p></li><li><p>我们增加如下插件配置</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> HardSourceWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;hard-source-webpack-plugin&#39;</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">HardSourceWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>执行<code>npm run build</code>.打印日志如下</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token literal-property property">Hash</span><span class="token operator">:</span> 929d247d9241bcef072a
<span class="token literal-property property">Version</span><span class="token operator">:</span> webpack <span class="token number">4.46</span><span class="token number">.0</span>
<span class="token literal-property property">Time</span><span class="token operator">:</span> 450ms
Built at<span class="token operator">:</span> <span class="token number">2023</span><span class="token operator">/</span><span class="token number">04</span><span class="token operator">/</span><span class="token number">17</span> 下午<span class="token number">5</span><span class="token operator">:</span><span class="token number">29</span><span class="token operator">:</span><span class="token number">34</span>
    Asset      Size  Chunks             Chunk Names
common<span class="token punctuation">.</span>js  <span class="token number">60.6</span> KiB       <span class="token number">0</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  common
  main<span class="token punctuation">.</span>js  <span class="token number">1.56</span> KiB       <span class="token number">1</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  main
Entrypoint main <span class="token operator">=</span> common<span class="token punctuation">.</span>js main<span class="token punctuation">.</span>js
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>再次执行<code>npm run build</code>.打印日志如下</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>Hash: e439ca4d2cf3a8a49531
Version: webpack <span class="token number">4.46</span>.0
Time: 305ms
Built at: <span class="token number">2023</span>/04/17 下午5:30:27
    Asset      Size  Chunks             Chunk Names
common.js  <span class="token number">60.6</span> KiB       <span class="token number">0</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  common
  main.js  <span class="token number">1.56</span> KiB       <span class="token number">1</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  main
Entrypoint main <span class="token operator">=</span> common.js main.js
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>可以看到<code>node_modules</code>下的缓存目录多了一个<code>node_modules/.cache/hard-source</code></p></li><li><p>同样的，这个插件也是至此一些配置选项的</p></li></ol>`,56),u={href:"https://github.com/mzgoddard/hard-source-webpack-plugin",target:"_blank",rel:"noopener noreferrer"},d=p(`<h2 id="_04-webpack4-和-5-构建结果对比" tabindex="-1"><a class="header-anchor" href="#_04-webpack4-和-5-构建结果对比" aria-hidden="true">#</a> 04: webpack4 和 5 构建结果对比</h2><h3 id="资源模块处理" tabindex="-1"><a class="header-anchor" href="#资源模块处理" aria-hidden="true">#</a> 资源模块处理</h3><ul><li><p>webpack4 中处理字符图标等文件需要单独引入 loader 进行处理（以图片为例子）</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>npm install url<span class="token operator">-</span>loader file<span class="token operator">-</span>loader <span class="token operator">-</span><span class="token constant">S</span>

<span class="token punctuation">{</span>
  <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.(png|jpe?g|gif|svg)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">// 处理图片新增代码</span>
  <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;url-loader&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;[name].[hash:5].[ext]&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">limit</span><span class="token operator">:</span> <span class="token number">100</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">,</span>
    <span class="token literal-property property">outputPath</span><span class="token operator">:</span> <span class="token string">&quot;images&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>webpack5 中允许使用资源文件（字体、图标等）而无需配置额外 loader</p><blockquote><p>资源模块类型（asset modules types）通过四种新的模块类型，来替换所有的 loader</p></blockquote></li><li><p>asset/resource 发送一个单独的文件并导出 URL，之前通过 file-loader 实现</p></li><li><p>asset/inline 导出一个资源的 data URL，之前通过 url-loader 实现</p></li><li><p>asset/source 导出资源的源代码，之前通过使用 raw-loader 实现</p></li><li><p>asset 在导出一个 data URL 和发送一个单独的文件之间自动选择，之前通过使用 url-loader 并且配置资源体积限制实现</p></li></ul><h3 id="代码实操" tabindex="-1"><a class="header-anchor" href="#代码实操" aria-hidden="true">#</a> 代码实操</h3><h4 id="webpack4" tabindex="-1"><a class="header-anchor" href="#webpack4" aria-hidden="true">#</a> webpack4</h4><ol><li><p>我们在 webpack4-demo 项目下的新建 <code>assets/images</code>文件夹, 并放入一张图片，比如<code>a.png</code></p></li><li><p>我们在<code>src/index.js</code>中增加如下代码</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> aImg <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;../assets/images/a.png&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
img<span class="token punctuation">.</span>src <span class="token operator">=</span> aImg
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>firstChild<span class="token punctuation">)</span>

<span class="token comment">// 也可以如下写</span>
<span class="token comment">// const aImg = require(&#39;../assets/images/a.png&#39;)</span>
<span class="token comment">// const img = document.createElement(&#39;img&#39;)</span>
<span class="token comment">// img.src = aImg</span>
<span class="token comment">// document.body.insertBefore(img, document.body.firstChild)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>修改<code>webpack.config.js</code>，增加如下配置</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.(png|jpe?g|gif|svg)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">// 处理图片新增代码</span>
        <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&#39;url-loader&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">esModule</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 这里设置为false，否则打包出来是 [object Module]</span>
          <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;[name].[hash:5].[ext]&#39;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">limit</span><span class="token operator">:</span> <span class="token number">10</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">,</span>
          <span class="token literal-property property">outputPath</span><span class="token operator">:</span> <span class="token string">&#39;images&#39;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>安装依赖库</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> installl file-loder url-loader <span class="token parameter variable">-D</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>运行打包命令<code>npm run build</code>，新建<code>dist/index.html</code>,引用<code>dist/main.js</code>，打开至浏览器就可以看到图片渲染效果</p></li></ol><h4 id="webpack5" tabindex="-1"><a class="header-anchor" href="#webpack5" aria-hidden="true">#</a> webpack5</h4><ol><li><p>我们在 webpack4-demo 项目下的新建 <code>assets/images</code>文件夹, 并放入一张图片，比如<code>a.png</code></p></li><li><p>我们在<code>src/index.js</code>中增加如下代码</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> aImg <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;../assets/images/a.png&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> img <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">)</span>
img<span class="token punctuation">.</span>src <span class="token operator">=</span> aImg
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>firstChild<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>修改<code>webpack.config.js</code>，增加如下配置</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.(png|jpe?g|gif|svg)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">// 处理图片新增代码</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;asset&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">parser</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">dataUrlCondition</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">maxSize</span><span class="token operator">:</span> <span class="token number">1024</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">generator</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;images/[name].[hash:5][ext]&#39;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>重新运行<code>npm run build</code>，打包<code>dist</code>目录</p></li><li><p>新建<code>dist/index.html</code>,引用<code>dist/main.js</code>，打开至浏览器就可以看到图片渲染效果</p></li></ol><h2 id="_05-webpack5-高级特性-uris-解析" tabindex="-1"><a class="header-anchor" href="#_05-webpack5-高级特性-uris-解析" aria-hidden="true">#</a> 05: webpack5 高级特性：URIs 解析</h2>`,9),k={id:"uris",tabindex:"-1"},m=n("a",{class:"header-anchor",href:"#uris","aria-hidden":"true"},"#",-1),v={href:"https://www.webpackjs.com/blog/2020-10-10-webpack-5-release/#uris",target:"_blank",rel:"noopener noreferrer"},b=p(`<blockquote><p>更新文档内容</p><p>Webpack5 支持在请求中处理协议</p><ul><li>支持 data: 支持 Base64 或者原始编码。MimeType 可以在 module.rule 中被映射到加载器和模块类型。例如：import x from &quot;data:text/javascript,export default 42&quot;</li><li>支持 file: 支持引入本地资源文件（非项目中资源）</li><li>支持 http(s): 需要通过 new webapck.experiments.schmemesHttp(s)UrlPlugin() 选择加入。 <ul><li>默认情况下，当目标为 Web 时，这些 URI 会导致对外部资源的请求（他们是外部资源）</li></ul></li></ul></blockquote><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// data</span>
<span class="token keyword">import</span> data <span class="token keyword">from</span> <span class="token string">&quot;data:text/javascript,export default &#39;hello webapck4&#39;&quot;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>

<span class="token comment">// file</span>
<span class="token keyword">import</span> file <span class="token keyword">from</span> <span class="token string">&quot;file:///Users/gaoyuan/Desktop/demo/a.png&quot;</span>
<span class="token keyword">const</span> addImg <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;.addImg&quot;</span><span class="token punctuation">)</span>
addImg<span class="token punctuation">.</span><span class="token function">setAttributes</span><span class="token punctuation">(</span><span class="token string">&quot;src&quot;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>

<span class="token comment">// https</span>
<span class="token comment">// webpack.config.js</span>
<span class="token literal-property property">experiments</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">buildHttp</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">allowedUris</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;https://fast-learn-oss.youbaobao.xyz/&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;http://hp.hpbb.me//upload/20171108173745476048.jpeg?x-oss-process&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">frozen</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token literal-property property">cacheLocation</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token literal-property property">upgrade</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="webpack-4-中" tabindex="-1"><a class="header-anchor" href="#webpack-4-中" aria-hidden="true">#</a> webpack 4 中</h3><h3 id="webpack-5-中" tabindex="-1"><a class="header-anchor" href="#webpack-5-中" aria-hidden="true">#</a> webpack 5 中</h3><ol><li><p>在<code>webpack5-demo/src/index.js</code>中加入以下代码</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> data <span class="token keyword">from</span> <span class="token string">&quot;data:text/javascript,export default &#39;hello webpack5&#39;&quot;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>重新运行<code>npm run build</code>，在<code>dist/main.js</code>中搜索<code>hello webpack5</code>,发现可以搜索到</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c9e78f8e38024eaf8dab99efc076f3a5~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p></li><li><p>在<code>webpack5-demo/src/index.js</code>中再加入以下代码</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 这个路径根据自己的实际地址来处理</span>
<span class="token keyword">import</span> file <span class="token keyword">from</span> <span class="token string">&#39;file:///Users/gaoyuan/Desktop/webpack-feature/demo1/webpack5-demo/assets/images/a.png&#39;</span>
<span class="token keyword">const</span> addImg <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;.addImg&#39;</span><span class="token punctuation">)</span>
addImg<span class="token punctuation">.</span><span class="token function">setAttributes</span><span class="token punctuation">(</span><span class="token string">&#39;src&#39;</span><span class="token punctuation">,</span> file<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>重新运行<code>npm run build</code>,可以看到<code>dist/images</code>下多了<code>b.xxx.png</code>,而对应的<code>dist/main.js</code>中相关代码如下</p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/580ae2303a7f4dfabf98ef012062880e~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p></li><li><p>xx</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> ModuleA <span class="token keyword">from</span> <span class="token string">&#39;http://imooc-dev.youbaobao.xyz/test/moduleA.js&#39;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ModuleA<span class="token punctuation">.</span>a <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/848a94c964c7413a8652a5b121420e82~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p></li><li><p>执行<code>npm run build</code>,报错信息如下</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token constant">ERROR</span> <span class="token keyword">in</span> external <span class="token string">&quot;https://imooc-dev.youbaobao.xyz/test/moduleA.js&quot;</span>
The target environment doesn<span class="token string">&#39;t support dynamic import() syntax so it&#39;</span>s not possible to use external type <span class="token string">&#39;module&#39;</span> within a script
<span class="token literal-property property">Error</span><span class="token operator">:</span> The target environment doesn<span class="token string">&#39;t support dynamic import() syntax so it&#39;</span>s not possible to use external type <span class="token string">&#39;module&#39;</span> within a script
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>因为这个特性是一个实验特性，所以我们需要修改配置文件<code>webpack.config.js</code></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">experiments</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">buildHttp</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// 白名单域名</span>
      <span class="token literal-property property">allowedUris</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;http://imooc-dev.youbaobao.xyz&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token comment">// 还可以增加额外的特性</span>
      <span class="token literal-property property">cacheLocation</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>再次执行<code>npm run build</code>，可以看到一个报错信息</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token constant">ERROR</span> <span class="token keyword">in</span> <span class="token punctuation">.</span><span class="token operator">/</span>src<span class="token operator">/</span>index<span class="token punctuation">.</span>js <span class="token number">18</span><span class="token operator">:</span><span class="token number">0</span><span class="token operator">-</span><span class="token number">68</span>
Module not found<span class="token operator">:</span> Error<span class="token operator">:</span> http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>imooc<span class="token operator">-</span>dev<span class="token punctuation">.</span>youbaobao<span class="token punctuation">.</span>xyz<span class="token operator">/</span>test<span class="token operator">/</span>moduleA<span class="token punctuation">.</span>js has no lockfile entry and lockfile is frozen
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>我们修改<code>webpack.config.js</code>，如下</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">experiments</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">buildHttp</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">allowedUris</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;http://imooc-dev.youbaobao.xyz&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">cacheLocation</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token literal-property property">frozen</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>再次执行<code>npm run build</code>，打包成功，打开<code>dist/main.js</code>中寻找结果，如下(直接把结果计算后，赋值)</p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3af54be2c64a4f7fa52cbf3632c6c986~tplv-k3u1fbpfcp-watermark.image?" alt="image-20230418183209214.png"></p></li></ol><h2 id="_06-webpack5-高级特性-treeshaking-和-sideeffects" tabindex="-1"><a class="header-anchor" href="#_06-webpack5-高级特性-treeshaking-和-sideeffects" aria-hidden="true">#</a> 06: webpack5 高级特性：TreeShaking 和 SideEffects</h2><h3 id="tree-shaking" tabindex="-1"><a class="header-anchor" href="#tree-shaking" aria-hidden="true">#</a> Tree Shaking</h3><blockquote><p>tree shaking 是一个术语，通常用于描述移除 JavaScript 上下文中的未引用代码，webapck5 现在能够跟踪对导出的嵌套属性的访问。这可以改变重新导出命名空间对象的 tree shaking，</p><p>Webpack4 没有分析模块的导出和引用之间的依赖关系，webpack5 有一个新的选项 optimization.innerGraph 在生产模式下默认是开启的，他可以对模块中的标志进行分析，找出导出和引用之间的依赖关系</p></blockquote><h3 id="更高效的-treeshaking" tabindex="-1"><a class="header-anchor" href="#更高效的-treeshaking" aria-hidden="true">#</a> 更高效的 TreeShaking</h3><h4 id="webpack4-tree-shaking" tabindex="-1"><a class="header-anchor" href="#webpack4-tree-shaking" aria-hidden="true">#</a> webpack4 tree shaking</h4><p>在 webpack4 中是没有办法对 export default 中的对象进行 tree shaking 的</p><p>例如下面的，demo1 中导出一个对象含有 a、b 属性，index.js 中调用了 obj.a(), 而最终打包后的 main.js，中既有 a 属性又有 b 属性</p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0d676667e6cd412a8260c1b6329f1ea2~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><h4 id="webpack5-tree-shaking" tabindex="-1"><a class="header-anchor" href="#webpack5-tree-shaking" aria-hidden="true">#</a> webpack5 tree shaking</h4><p>而在 webpack5 中可以看到最终的 main.js 中直接把静态的结果放入到最后相应位置上，来解决 tree shaking 的问题。</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/463301f5ac224fd688d72d13436efd02~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><h3 id="sideeffect" tabindex="-1"><a class="header-anchor" href="#sideeffect" aria-hidden="true">#</a> SideEffect</h3>`,17),g={href:"https://webpack.docschina.org/guides/tree-shaking/#mark-the-file-as-side-effect-free",target:"_blank",rel:"noopener noreferrer"},h=p(`<h4 id="webpack4-中-1" tabindex="-1"><a class="header-anchor" href="#webpack4-中-1" aria-hidden="true">#</a> webpack4 中</h4><ol><li><p>注释<code>src/index.js</code>中所有内容，删除 <code>dist</code> 目录，添加如下代码</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// index.js</span>
<span class="token keyword">import</span> <span class="token string">&#39;./lib&#39;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment">// src/lib.js ：注意此文件并没有 export 任何内容</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;lib&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>运行<code>npm run build</code>,<code>dist/main.js</code>结果如下(可以看到 lib 文件有被加载进来)</p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f84714ff4e2748b9bc35a4e1b825f885~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p></li><li><p>接下来我们注释掉<code>src/lib.js</code>中的代码</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// console.log(&#39;lib&#39;)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>再次进行打包<code>npm run build</code>，可以看到如下结果</p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0c95f99b792d46ed932fc886faa1a8a1~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p></li><li><p>我们再次修改<code>inde.js</code>文件如下</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 可能会需要先安装 vue 那就执行 npm install vue -S</span>

<span class="token keyword">import</span> <span class="token string">&#39;./lib&#39;</span>
<span class="token keyword">import</span> <span class="token string">&#39;vue&#39;</span> <span class="token comment">// 引入 vue 但是没有使用</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>再次进行打包<code>npm run build</code>，可以看到如下结果(<code>dist/main.js</code>瞬间变大了，因为它把<code>vue</code>包全部打入进入了，它并不能准确的判断出我们有没有使用，为了避免出错，就直接全部打入)</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/06f5904f757842d0b32daeabbd47a545~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p></li></ol><h4 id="webpack5-中-1" tabindex="-1"><a class="header-anchor" href="#webpack5-中-1" aria-hidden="true">#</a> webpack5 中</h4><ol><li><p>注释<code>src/index.js</code>中所有内容，删除 <code>dist</code> 目录，添加如下代码</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// index.js</span>
<span class="token keyword">import</span> <span class="token string">&#39;./lib&#39;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment">// src/lib.js ：注意此文件并没有 export 任何内容</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;lib&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>运行<code>npm run build</code>,<code>dist/main.js</code>结果如下(可以看到 lib 文件有被加载进来,但是文件内容已经少了很多)</p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/79daf8573a8a4763b4869515fffcc1e7~tplv-k3u1fbpfcp-watermark.image?" alt="image-20230418230349844.png"></p></li><li><p>接下来我们注释掉<code>src/lib.js</code>中的代码</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// console.log(&#39;lib&#39;)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>再次进行打包<code>npm run build</code>，可以看到如下结果(就剩下一行代码了)</p><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8b84bcde16e94e2a9ad082420bd0020d~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p></li><li><p>我们再次修改<code>index.js</code>文件如下</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 可能会需要先安装 vue 那就执行 npm install vue -S</span>

<span class="token keyword">import</span> <span class="token string">&#39;./lib&#39;</span>
<span class="token keyword">import</span> <span class="token string">&#39;vue&#39;</span> <span class="token comment">// 引入 vue 但是没有使用</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>再次进行打包<code>npm run build</code>，可以看到如下结果(<code>dist/main.js</code>并没有变大，因为<code>webpack5</code>默认采取了一种激进的方式，我认为你并没有使用，所以我并不对它进行打包)，当然它采取了一种相对只能的方式来进行处理，比如如果你有 对其进行 console.log 之类的，他就会打进去</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6aabc76e412148a6bdc4030fd2f80951~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p></li><li><p>上面步骤显示了 webpack5 和 webpack4 之间的一个打包差异，那么我们能不能自己进行控制呢？</p></li><li><p>答案是可以的，这里就要用到这个新特性 <code>Effects</code></p></li><li><p>首先我们更改<code>index.js</code>文件内容如下</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token string">&#39;./lib&#39;</span>
<span class="token comment">// import &quot;vue&quot; // 引入 vue 但是没有使用</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment">// lib.js 打开注释</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;lig&#39;</span><span class="token punctuation">)</span> <span class="token comment">// 这里前面我们已经看到了，如果注释，webpack5  打包就会忽略这个文件，打包结果只有一行，如果不注释，这行代码就会被打包进打包文件</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>我们可以修改<code>package.json</code>中的<code>Effects</code>来处理</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;sideEffects&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// 表示我认为它有副作用</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>再次进行打包<code>npm run build</code>，可以看到如下结果</p><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2b99780c01744a9281bf6edf54110055~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p></li><li><p>再次修改<code>package.json</code>中的<code>Effects</code>来处理</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;sideEffects&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>再次进行打包<code>npm run build</code>，可以看到如下结果</p><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8b84bcde16e94e2a9ad082420bd0020d~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p></li><li><p>同时我们还可以对某个文件进行精准控制，比如修改<code>sideEffects</code>为如下结果</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;sideEffects&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;./src/lib.js&quot;</span> <span class="token comment">// 认为它有副作用，要打包</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>由此我们知道，除了常规的<code>import { a } from &quot;moduleA&quot;</code>的 tree shaking 方式以外，还有一个 <code>sideEffects</code> 方式来进行精准的 <code>tree shaking</code>（其实绝大多数情况下，是不需要进行更改的，使用默认值 false 让 webpack 进行决策即可，如果你发现打包结果与想要的效果不一致时，就可以检查是否是由于副作用导致了其他问题，从而可以使用<code>sideEffects</code>来进行精准控制）</p></li></ol><h2 id="_07-webpack5-高级特性-模块联邦" tabindex="-1"><a class="header-anchor" href="#_07-webpack5-高级特性-模块联邦" aria-hidden="true">#</a> 07: webpack5 高级特性：模块联邦</h2><h3 id="模块联邦" tabindex="-1"><a class="header-anchor" href="#模块联邦" aria-hidden="true">#</a> 模块联邦</h3><blockquote><p>模块联邦是 Webpack5 新内置的一个重要功能，可以让跨应用间真正做到模块共享，webpack5 新增 Module Federation（模块联邦）功能，它可以帮助多个独立的构建组成一个应用程序，不同的构建可以独立的开发与部署</p><ul><li>name 应用名，全局唯一，不可冲突</li><li>library UMD 标准导出，和 name 保持一直即可</li><li>remotes 声明需要引用的远程应用</li><li>filenames 远程应用时被其他应用引入的 js 文件名称，</li><li>exposes 远程应用暴露出的模块名</li><li>share 依赖的包</li></ul></blockquote><h3 id="federated-module" tabindex="-1"><a class="header-anchor" href="#federated-module" aria-hidden="true">#</a> Federated Module</h3><p>这个方案是直接将一个应用的包应用于另一个应用，同时具备整体应用一起打包的公共依赖抽取能力。让应用具备模块化输出能力，其实开辟了一中新的应用形态，即“中心应用”，这个中心应用用于在线动态分布 Runtime 子模块，并不直接提供给用户使用。所有子应用都可以利用 Runtime 方式复用主要的 Npm 包和模块，更好的集成到主应用中</p><ol><li><p>新建文件夹<code>demo2/app_a</code>（做为子应用）以及 <code>demo2/app_b</code> (b 作为主应用)</p></li><li><p>终端进入<code>app_a</code>文件夹，执行命令</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> init <span class="token parameter variable">-y</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>新建<code>app_a/webpack.config.js</code>(拷贝<code>demo1/webpack5-demo/webpack.config.js</code>，并增加 devServer 配置)</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&#39;production&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">&#39;./src/index.js&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;dist&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;[name].js&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">splitChunks</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">minSize</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">,</span>
      <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">&#39;all&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;common&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// cache: true, 适合开发模式</span>
  <span class="token comment">// cache: true, //cache: true 与 cache: { type: &#39;memory&#39; } 配置作用一致。 传入 false 会禁用缓存:</span>
  <span class="token literal-property property">cache</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;filesystem&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.(png|jpe?g|gif|svg)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">// 处理图片新增代码</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;asset&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">parser</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">dataUrlCondition</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">maxSize</span><span class="token operator">:</span> <span class="token number">1024</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">generator</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;images/[name].[hash:5][ext]&#39;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">experiments</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">buildHttp</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// 白名单域名</span>
      <span class="token literal-property property">allowedUris</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;http://imooc-dev.youbaobao.xyz&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token comment">// 还可以增加额外的特性</span>
      <span class="token literal-property property">cacheLocation</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token literal-property property">frozen</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 需要增加如下配置</span>
  <span class="token literal-property property">devServer</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token string">&#39;localhost&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>新建文件<code>src/index.js</code>，内容如下</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;子应用启用中&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> run
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>安装<code>webpack webpack-cli webpack-dev-server </code> 模块</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> webpack webpack-cli webpack-dev-server <span class="token parameter variable">-D</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>接着我们修改<code>package.json</code>中的脚本命令</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webapck&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack server&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>执行 <code>npm run start</code> 来启动服务</p></li><li><p>此时打开 <code>http://localhost:3000/main.js</code>时就可以看到相应打包后的代码</p></li><li><p>接着处理 <code>app_b</code></p></li><li><p>终端进 入 <code>app_b</code> 文件夹，执行命令</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> init <span class="token parameter variable">-y</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>新建 <code>app_a/webpack.config.js</code> (拷贝<code>demo1/webpack5-demo/webpack.config.js</code>，并增加 <code>devServer plugins</code> 配置)</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;html-webpack-plugin&#39;</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&#39;production&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">&#39;./src/index.js&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;dist&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;[name].js&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">splitChunks</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">minSize</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">,</span>
      <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">&#39;all&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;common&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// cache: true, 适合开发模式</span>
  <span class="token comment">// cache: true, //cache: true 与 cache: { type: &#39;memory&#39; } 配置作用一致。 传入 false 会禁用缓存:</span>
  <span class="token literal-property property">cache</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;filesystem&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.(png|jpe?g|gif|svg)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">// 处理图片新增代码</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;asset&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">parser</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">dataUrlCondition</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">maxSize</span><span class="token operator">:</span> <span class="token number">1024</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">generator</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;images/[name].[hash:5][ext]&#39;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">experiments</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">buildHttp</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// 白名单域名</span>
      <span class="token literal-property property">allowedUris</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;http://imooc-dev.youbaobao.xyz&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token comment">// 还可以增加额外的特性</span>
      <span class="token literal-property property">cacheLocation</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token literal-property property">frozen</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 需要增加如下配置</span>
  <span class="token literal-property property">devServer</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token string">&#39;localhost&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">3001</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">&#39;./public/index.html&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>由于<code>webpack-dev-server</code>默认会使用<code>public</code>作为静态资源文件夹</p></li><li><p>我们新建<code>app_b/public/index.html</code>，内容如下</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>IE=edge<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Main Module<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>新建文件<code>src/index.js</code>，内容如下</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;主应用启动中&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>安装<code>webpack webpack-cli webpack-dev-server </code> 模块</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> html-webpack-plugin webpack webpack-cli webpack-dev-server <span class="token parameter variable">-D</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>接着我们修改<code>package.json</code>中的脚本命令</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webapck&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack server&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>执行 <code>npm run start</code> 来启动服务 http://localhost:3001/ 就可以在控制台看到输出信息</p></li><li><p>接下来就到了关键时候，这时候我们是启动了两个单独的服务，并且两个服务之间还没有任何的关联、联动</p></li><li><p>修改 app_a 中的 webpack.config.js 增加内容如下</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> ModuleFederationPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;webpack/lib/container/ModuleFederationPlugin&#39;</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">ModuleFederationPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token comment">// 暴露的文件名称</span>
      <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;app_a.js&#39;</span><span class="token punctuation">,</span>
      <span class="token comment">// 应用名，全局唯一，不可冲突。 f</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;app_a&#39;</span><span class="token punctuation">,</span>
      <span class="token comment">// 远程应用暴露出的模块名。</span>
      <span class="token literal-property property">exposes</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&#39;./moduleA&#39;</span><span class="token operator">:</span> <span class="token string">&#39;./src/index.js&#39;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>在 app_a 中重新运行 npm run start ，就会重新打包，从而向外部暴露一个模块</p></li><li><p>接着我们来到 app_b 中对暴露的模块进行一个接收,修改 package.json 如下</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> ModuleFederationPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;webpack/lib/container/ModuleFederationPlugin&#39;</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">&#39;./public/index.html&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// 增加插件</span>
    <span class="token keyword">new</span> <span class="token class-name">ModuleFederationPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;app_b.js&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;app_b&#39;</span><span class="token punctuation">,</span>
      <span class="token comment">// 远程访问地址入口</span>
      <span class="token literal-property property">remotes</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">app_a</span><span class="token operator">:</span> <span class="token string">&#39;app_a@http://localhost:3000/main.js&#39;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>接这修改 app_a/src/index.js 中的代码</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;主应用启动中&#39;</span><span class="token punctuation">)</span>

<span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&#39;app_a/moduleA&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> moduleA <span class="token operator">=</span> res<span class="token punctuation">.</span>default
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">moduleA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token number">11122</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>在 app_b 中启动脚本 npm run dev ,打开 localhost:3001 就可以看到控制台输出日志</p></li><li><p>目前本地运行报错，不知道为什么，？？？？？？？？？？？待解决</p></li></ol><h2 id="_08-webpack5-高级特性-packageexports" tabindex="-1"><a class="header-anchor" href="#_08-webpack5-高级特性-packageexports" aria-hidden="true">#</a> 08: webpack5 高级特性：PackageExports</h2><h3 id="支持全新的-node-js-生态特性" tabindex="-1"><a class="header-anchor" href="#支持全新的-node-js-生态特性" aria-hidden="true">#</a> 支持全新的 node.js 生态特性</h3>`,12),y={href:"https://webpack.docschina.org/guides/package-exports/",target:"_blank",rel:"noopener noreferrer"},f=p(`<ol><li><p>新建 demo3/lib demo3/work 文件夹</p></li><li><p>进入 demo3/lib，执行以下命令</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> init <span class="token parameter variable">-y</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>新建 lib/a.js lib/b.js</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// a.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;a.js&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// b.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;b.js&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>在 <code>demo3/lib</code> 文件夹下，执行</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">link</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>修改 <code>lib/package.json</code></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;lib&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// 修改 main 属性</span>
  <span class="token string-property property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;a.js&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;echo \\&quot;Error: no test specified\\&quot; &amp;&amp; exit 1&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;keywords&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ISC&quot;</span><span class="token punctuation">,</span>
   <span class="token comment">// 增加 exports 属性，require 的时候调用 a.js, import的时候加载 b.js</span>
  <span class="token string-property property">&quot;exports&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;require&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./a.js&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;import&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./b.js&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>进入 <code>demo3/work</code> 目录下</p></li><li><p>执行以下命令</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> init <span class="token parameter variable">-y</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>新建<code>webpack.config.js</code>， 内容如下</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// demo3/work/webpack.config.js</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&#39;production&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">&#39;./index.js&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;dist&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;[name].js&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>新建 <code>index.js</code>，内容如下</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> library <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;lib&#39;</span><span class="token punctuation">)</span>
<span class="token function">library</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>执行一个命令，对 lib 进行一个链接引用</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">link</span> lib
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>安装相关依赖</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> webpack webpack-cli <span class="token parameter variable">-D</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>修改 <code>package.json</code> 文件如下</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">{</span>
 <span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>然后执行 <code>npm run build</code>，查看 <code>dist/main.js</code> 文件</p></li><li></li><li><p>接着我们换一种方式，修改 <code>demo3/work/index.js</code></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// const library = require(&#39;lib&#39;)</span>
<span class="token keyword">import</span> library <span class="token keyword">from</span> <span class="token string">&quot;lib&quot;</span>
<span class="token function">library</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>再次执行 <code>npm run build</code>，查看 <code>dist/main.js</code> 文件</p></li></ol><h2 id="参考文章" tabindex="-1"><a class="header-anchor" href="#参考文章" aria-hidden="true">#</a> 参考文章</h2>`,2),j={href:"https://juejin.cn/post/6983985071699001357#heading-1",target:"_blank",rel:"noopener noreferrer"};function w(x,q){const a=o("ExternalLinkIcon");return i(),c("div",null,[r,n("p",null,[n("a",u,[s("文档：https://github.com/mzgoddard/hard-source-webpack-plugin"),e(a)])]),d,n("h3",k,[m,s(),n("a",v,[s("URIS"),e(a)])]),b,n("p",null,[n("a",g,[s("将文件标记为 side-effect-free(无副作用):https://webpack.docschina.org/guides/tree-shaking/#mark-the-file-as-side-effect-free"),e(a)])]),h,n("blockquote",null,[n("p",null,[s("现在支持 package.json 中的 exports 和 imports 字段，原生支持 Yarn Pnpm 更多细节参见"),n("a",y,[s("package exports"),e(a)])])]),f,n("p",null,[n("a",j,[s("webpack5 新特性:https://juejin.cn/post/6983985071699001357#heading-1"),e(a)])])])}const B=t(l,[["render",w],["__file","index-12.html.vue"]]);export{B as default};
